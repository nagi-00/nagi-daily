<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>𝐝 : ᴅᴀɪʟʏ</title>
  <link rel="icon" href="./favi.ico" />
  <style>
    @font-face { font-family:'HJSS'; src:url('./HJSS.ttf') format('truetype'); }
    @font-face { font-family:'bbang'; src:url('./bbang.ttf') format('truetype'); }
    @font-face { font-family:'ywoo'; src:url('./ywoo.ttf') format('truetype'); }
    @font-face { font-family:'caa'; src:url('./caa.ttf') format('truetype'); }
    body { margin:0; padding:0; font-family:'HJSS',sans-serif; background:#f5f5f5; }

    .sidebar { position:fixed; left:0; top:0; bottom:0; width:16rem; background:#fff; overflow:auto;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1rem; }
    .main { margin-left:16rem; padding:1rem; display:flex; justify-content:center; }

    .nav-btns { display:flex; justify-content:center; gap:0.5rem; margin:0.5rem 0;
      white-space: nowrap; }
    .nav-btns button { background:#fff; border:none; padding:0.5rem 1rem; cursor:pointer; }

    .toggle-btn { margin:1rem 0; width:100%; padding:0.5rem; border:none; background:#fff;
      cursor:pointer; font-weight:bold; border-radius:0.25rem; white-space: nowrap; }

    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:0.25rem; font-size:0.875rem; }
    .calendar-day { text-align:center; font-weight:500; }
    .calendar-date { position:relative; width:1.8rem; height:1.8rem; display:flex;
      align-items:center; justify-content:center; background:#fff; border:none;
      border-radius:9999px; cursor:pointer; transition: background 0.2s; }
    .calendar-date.has-record {
      background: var(--highlight-color,#888)33;
    }
    .calendar-date.highlight {
      background: var(--highlight-color,#888);
      color:#fff;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script type="text/babel">
    // 임시 스텁: 에러 방지용. 실제 구현하길 원하는 기능을 알려주세요.
    const NoteArea = ({ dateKey }) => (
      <div style={{ padding:'1rem', border:'1px solid #ddd' }}>
        NoteArea placeholder: {dateKey}
      </div>
    );
    const MonthlySummary = ({ year, month }) => (
      <div style={{ padding:'1rem', border:'1px solid #ddd' }}>
        MonthlySummary placeholder: {year}-{month+1}
      </div>
    );

    // Firebase 초기화
    const firebaseConfig = {
      apiKey: "...",
      authDomain: "...",
      databaseURL: "https://nagi-daily-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "...",
      storageBucket: "...",
      messagingSenderId: "...",
      appId: "..."
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function App() {
      const [view, setView] = React.useState('daily');
      const [selectedDate, setSelectedDate] = React.useState(new Date());
      const dateKey = selectedDate.toLocaleDateString('sv-SE');
      const [dateColor, setDateColor] = React.useState('#888888');
      const [allPages, setAllPages] = React.useState({});

      React.useEffect(() => {
        const ref = database.ref('pages');
        ref.on('value', snap => setAllPages(snap.val() || {}));
        return () => ref.off();
      }, []);

      React.useEffect(() => {
        const cref = database.ref(`pages/${dateKey}/color`);
        cref.on('value', snap => setDateColor(snap.val() || '#888888'));
        return () => cref.off();
      }, [dateKey]);

      const prev  = () => setSelectedDate(d => new Date(d.getFullYear(), d.getMonth()-1, 1));
      const next  = () => setSelectedDate(d => new Date(d.getFullYear(), d.getMonth()+1, 1));
      const today = () => setSelectedDate(new Date());

      const y  = selectedDate.getFullYear();
      const m  = selectedDate.getMonth();
      const fd = new Date(y, m, 1).getDay();
      const td = new Date(y, m+1, 0).getDate();
      const days = ['S','M','T','W','T','F','S'];

      const toggleLabel = view === 'daily'
        ? '🇲 🇴 🇳 🇴 🇭 🇱 🇾'
        : '🇷 🇪 🇹 🇺 🇷 🇳';

      return (
        <div style={{ display:'flex' }}>
          <div className="sidebar">
            <h2 style={{ textAlign:'center', whiteSpace:'pre-line', marginBottom:'1rem' }}>
              {y}{'\n'}{selectedDate.toLocaleDateString('en-US',{month:'long'})}
            </h2>
            <div className="nav-btns">
              <button onClick={prev}>←</button>
              <button onClick={today}>Today</button>
              <button onClick={next}>→</button>
            </div>
            <button className="toggle-btn"
              onClick={() => setView(v => v === 'daily' ? 'monthly' : 'daily')}>
              {toggleLabel}
            </button>
            <div className="calendar" style={{ '--highlight-color': dateColor }}>
              {days.map((d,i) =>
                <div key={i} className="calendar-day"
                  style={{ color: i===0? '#8A4545' : i===6? '#434A8E' : '#666' }}>
                  {d}
                </div>
              )}
              {Array(fd).fill().map((_,i)=><div key={`e${i}`}/>)}
              {Array.from({ length: td }).map((_,i) => {
                const dt = new Date(y,m,i+1);
                const k  = dt.toLocaleDateString('sv-SE');
                const sel = k === dateKey;
                const rec = Boolean(allPages[k]);
                const classes = [
                  'calendar-date',
                  sel ? 'highlight' : '',
                  !sel && rec ? 'has-record' : ''
                ].join(' ');
                return (
                  <button key={i}
                    className={classes}
                    onClick={() => { setSelectedDate(dt); setView('daily'); }}>
                    {i+1}
                  </button>
                );
              })}
            </div>
          </div>
          <div className="main">
            {view === 'daily'
              ? <NoteArea dateKey={dateKey} highlightColor={dateColor} onColorChange={c=>database.ref(`pages/${dateKey}/color`).set(c)}/>
              : <MonthlySummary year={y} month={m}/>
            }
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
