<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğ : á´…á´€ÉªÊŸÊ</title>
  <link rel="icon" href="./favi.ico" type="image/x-icon" />
  <style>
    @font-face { font-family:'HJSS'; src:url('./HJSS.ttf') format('truetype'); }
    body { margin:0; padding:0; font-family:'HJSS',sans-serif; background:#f5f5f5; box-sizing:border-box; }
    *,*::before,*::after { box-sizing:inherit; }
    .sidebar { position:fixed; left:0; top:0; bottom:0; width:16rem; background:#fff; overflow:auto;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1rem; }
    .main { margin-left:16rem; padding:1rem; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:0.25rem; font-size:0.875rem; }
    .calendar-day { text-align:center; font-weight:500; }
    .calendar-date { width:1.8rem; height:1.8rem; display:flex; align-items:center; justify-content:center;
      border:none; border-radius:9999px; background:transparent; cursor:pointer; }
    .highlight { background:var(--highlight-color,#888); color:#fff; }
    .note-area, .summary-area { max-width:42rem; margin:0 auto; background:#fff; border-radius:0.5rem;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1.5rem; }
    .section { margin-bottom:1rem; }
    .section h2 { font-size:1.25rem; font-weight:bold; margin-bottom:0.5rem; }
    textarea { width:100%; border:1px solid #ccc; padding:0.5rem; border-radius:0.25rem;
      resize:vertical; font-weight:normal; }
    .color-picker { width:1.5rem; height:1.5rem; border:none; padding:0; cursor:pointer; margin-bottom:1rem; }
    .mood-tracker { display:flex; gap:0.5rem; margin-bottom:1rem; }
    .mood-tracker button { font-size:1.5rem; background:transparent; border:1px solid #ccc;
      border-radius:0.25rem; cursor:pointer; padding:0.25rem; }
    .mood-tracker button:hover { opacity:0.8; }
    .toggle-btn { margin-top:1rem; background:#fff; border:none; color:#000; cursor:pointer;
      font-weight:bold; width:100%; text-align:center; padding:0.5rem; border-radius:0.25rem; }
    .summary-area div { margin-bottom:0.75rem; font-size:1rem; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script type="text/babel">
    // í™˜ê²½ ì²´í¬: íŒŒì¼ í”„ë¡œí† ì½œì¼ ê²½ìš° Firebase ë™ì‘ ì œí•œ
    if (window.location.protocol === 'file:') {
      alert('âš ï¸ Firebase ì—°ë™ì„ ìœ„í•´ HTTP í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.');
    }
    // Firebase ì´ˆê¸°í™”
    const firebaseConfig = { /* ... */ };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function MoodTracker({ dateKey, highlightColor }) {
      const [mood, setMood] = React.useState('');
      React.useEffect(() => {
        const ref = database.ref(`pages/${dateKey}/mood`);
        const off = ref.on('value', snap => setMood(snap.val() || ''));
        return () => ref.off('value', off);
      }, [dateKey]);
      const labels = { happy:'ğŸ˜»', neutral:'ğŸ˜º', sad:'ğŸ˜¿', angry:'ğŸ˜¾', excited:'âœ¨' };
      return (
        <div className="mood-tracker">
          {Object.entries(labels).map(([key, emoji]) => (
            <button key={key}
              onClick={() => database.ref(`pages/${dateKey}/mood`).set(key)}
              style={{ background: mood===key ? highlightColor : 'transparent', border: mood===key ? 'none' : '1px solid #ccc' }}>
              {emoji}
            </button>
          ))}
        </div>
      );
    }

    function NoteArea({ dateKey, highlightColor, onColorChange }) {
      const [morning, setMorning] = React.useState('');
      const [gratitude, setGratitude] = React.useState('');
      React.useEffect(() => {
        database.ref(`pages/${dateKey}/morning`).on('value', snap => setMorning(snap.val() || ''));
        database.ref(`pages/${dateKey}/gratitude`).on('value', snap => setGratitude(snap.val() || ''));
      }, [dateKey]);
      return (
        <div className="note-area">
          <input type="color" className="color-picker" value={highlightColor} onChange={e => onColorChange(e.target.value)} />
          <div className="section">
            <h2 style={{ color: highlightColor }}>á´á´Ê€É´ÉªÉ´É¢</h2>
            <textarea rows={4} value={morning}
              onChange={e => { database.ref(`pages/${dateKey}/morning`).set(e.target.value); setMorning(e.target.value); }}
              style={{ borderColor: highlightColor }} />
          </div>
          <MoodTracker dateKey={dateKey} highlightColor={highlightColor} />
          <div className="section">
            <h2 style={{ color: highlightColor }}>á´‡á´ á´‡É´ÉªÉ´É¢</h2>
            <textarea rows={4} value={gratitude}
              onChange={e => { database.ref(`pages/${dateKey}/gratitude`).set(e.target.value); setGratitude(e.target.value); }}
              style={{ borderColor: highlightColor }} />
          </div>
        </div>
      );
    }

    function MonthlySummary({ year, month }) {
      const [counts, setCounts] = React.useState(null);
      React.useEffect(() => {
        database.ref('pages').once('value', snap => {
          const data = snap.val() || {};
          let mCount=0, gCount=0;
          const moodCount={happy:0,neutral:0,sad:0,angry:0,excited:0};
          Object.entries(data).forEach(([d,val])=>{
            const dt=new Date(d);
            if(dt.getFullYear()===year&&dt.getMonth()===month){
              if(val.morning) mCount++;
              if(val.gratitude) gCount++;
              if(val.mood&&moodCount[val.mood]!==undefined) moodCount[val.mood]++;
            }
          });
          setCounts({ morning:mCount, gratitude:gCount, ...moodCount });
        });
      },[year,month]);
      if(counts===null) return <div className="summary-area"><p>ğŸ‡³ ğŸ‡´ ğŸ‡¼  ğŸ‡± ğŸ‡´ ğŸ‡¦ ğŸ‡© ğŸ‡® ğŸ‡³ ğŸ‡¬ . . .</p></div>;
      return (
        <div className="summary-area">
          <div>â˜€ï¸ {counts.morning}</div>
          <div>ğŸŒ™ {counts.gratitude}</div>
          <div>ğŸ˜» {counts.happy}</div>
          <div>ğŸ˜º {counts.neutral}</div>
          <div>ğŸ˜¿ {counts.sad}</div>
          <div>ğŸ˜¾ {counts.angry}</div>
          <div>âœ¨ {counts.excited}</div>
        </div>
      );
    }

    function App() {
      const [view, setView] = React.useState('daily');
      const [selectedDate, setSelectedDate] = React.useState(new Date());
      const dateKey=selectedDate.toLocaleDateString('sv-SE');
      const [dateColor, setDateColor] = React.useState('#888888');
      React.useEffect(()=>{
        setDateColor('#888888');
        const ref=database.ref(`pages/${dateKey}/color`);
        ref.on('value', snap=>setDateColor(snap.val()||'#888888'));
      },[dateKey]);

      const prevMonth=()=>setSelectedDate(d=>new Date(d.getFullYear(),d.getMonth()-1,1));
      const nextMonth=()=>setSelectedDate(d=>new Date(d.getFullYear(),d.getMonth()+1,1));
      const goToday=()=>setSelectedDate(new Date());
      const changeColor=c=>database.ref(`pages/${dateKey}/color`).set(c);

      const year=selectedDate.getFullYear();
      const month=selectedDate.getMonth();
      const firstDay=new Date(year,month,1).getDay();
      const totalDays=new Date(year,month+1,0).getDate();
      const days=['S','M','T','W','T','F','S'];

      return (
        <div style={{display:'flex'}}>
          <div className="sidebar">
            <h2 style={{textAlign:'center',whiteSpace:'pre-line',marginBottom:'1rem'}}>
              {year}{'\n'}{selectedDate.toLocaleString('en-US',{month:'long'})}
            </h2>
            <div style={{display:'flex',justifyContent:'center',gap:'0.5rem',margin:'0.5rem 0'}}>
              <button onClick={prevMonth} style={{background:'#fff',border:'none',cursor:'pointer'}}>â†</button>
              <button onClick={goToday} style={{background:'#fff',border:'none',cursor:'pointer'}}>Today</button>
              <button onClick={nextMonth} style={{background:'#fff',border:'none',cursor:'pointer'}}>â†’</button>
            </div>
            <button className="toggle-btn" onClick={()=>setView(v=>v==='daily'?'ğŸ‡² ğŸ‡´ ğŸ‡³ ğŸ‡¹ ğŸ‡­ ğŸ‡± ğŸ‡¾':'ğŸ‡· ğŸ‡ª ğŸ‡¹ ğŸ‡º ğŸ‡· ğŸ‡³')}>â€¦</button>
            <div className="calendar">â€¦</div>
          </div>
          <div className="main">
            {view==='daily'? <NoteArea key={dateKey} dateKey={dateKey} highlightColor={dateColor} onColorChange={changeColor}/> : <MonthlySummary year={year} month={month}/>}        
          </div>
        </div>
      );
    }
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
