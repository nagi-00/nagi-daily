<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ùêù : ·¥Ö·¥Ä…™ ü è</title>
  <link rel="icon" href="./favi.ico" />
  <style>
    @font-face { font-family:'HJSS'; src:url('./HJSS.ttf') format('truetype'); }
    @font-face { font-family:'bbang'; src:url('./bbang.ttf') format('truetype'); }
    @font-face { font-family:'ywoo'; src:url('./ywoo.ttf') format('truetype'); }
    @font-face { font-family:'caa'; src:url('./caa.ttf') format('truetype'); }
    body { margin:0; padding:0; font-family:'HJSS',sans-serif; background:#f5f5f5; }
    .sidebar { position:fixed; left:0; top:0; bottom:0; width:16rem; background:#fff; overflow:auto;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1rem; }
    .main { margin-left:16rem; padding:1rem; display:flex; justify-content:center; }
    .nav-btns { display:flex; justify-content:center; gap:0.5rem; margin:0.5rem 0; white-space:nowrap; }
    .nav-btns button { background:#fff; border:none; padding:0.5rem 1rem; cursor:pointer; }
    .toggle-btn { margin:1rem 0; width:100%; padding:0.5rem; border:none; background:#fff;
      cursor:pointer; font-weight:bold; border-radius:0.25rem; white-space:nowrap; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:0.25rem; font-size:0.875rem; }
    .calendar-day { text-align:center; font-weight:500; }
    .calendar-date { position:relative; width:1.8rem; height:1.8rem; display:flex;
      align-items:center; justify-content:center; background:#fff; border:none; border-radius:9999px;
      cursor:pointer; transition:background 0.2s; }
    .calendar-date.has-record { background: var(--highlight-color,#888)33; }
    .calendar-date.highlight { background: var(--highlight-color,#888); color:#fff; }
    .note-area, .summary-area { max-width:42rem; background:#fff; border-radius:0.5rem;
      box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:1.5rem; }
    .section { margin-bottom:1rem; }
    .section h2 { font-size:1.25rem; margin-bottom:0.5rem; }
    textarea { width:100%; padding:0.5rem; border:1px solid #ccc; border-radius:0.25rem;
      resize:vertical; }
    .color-picker { width:1.5rem; height:1.5rem; border:none; cursor:pointer; margin-bottom:1rem; }
    .font-select { margin-bottom:1rem; }
    .saved-text p { margin:0.25rem 0; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script type="text/babel">
    // Firebase Ï¥àÍ∏∞Ìôî (Í∏∞Ï°¥ ÏÑ§Ï†ï Ïú†ÏßÄ)
    const firebaseConfig = {/* ‚Ä¶ */ databaseURL: "https://nagi-daily-default-rtdb.asia-southeast1.firebasedatabase.app" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function MoodTracker({ dateKey, highlightColor }) {
      /* Í∏∞Ï°¥ Íµ¨ÌòÑ Ïú†ÏßÄ */
      // ‚Ä¶
    }

    function NoteArea({ dateKey, highlightColor, onColorChange }) {
      const [morning, setMorning] = React.useState('');
      const [gratitude, setGratitude] = React.useState('');
      const [editingMorning, setEditingMorning] = React.useState(false);
      const [editingGratitude, setEditingGratitude] = React.useState(false);
      const [font, setFont] = React.useState('HJSS');

      React.useEffect(() => {
        const mRef = database.ref(`pages/${dateKey}/morning`);
        const gRef = database.ref(`pages/${dateKey}/gratitude`);
        mRef.on('value', snap => {
          const val = snap.val() || '';
          setMorning(val);
          setEditingMorning(val === '');
        });
        gRef.on('value', snap => {
          const val = snap.val() || '';
          setGratitude(val);
          setEditingGratitude(val === '');
        });
        return () => { mRef.off(); gRef.off(); };
      }, [dateKey]);

      const handleKeyDown = (e, text, setText, path, setEditing) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          database.ref(path).set(text);
          setEditing(false);
        }
      };

      const exportImage = async () => {
        const el = document.querySelector('.note-area');
        const canvas = await html2canvas(el, { backgroundColor: '#fff', scale:2 });
        canvas.toBlob(blob => {
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = `daily-${dateKey}.png`;
          a.click();
        });
      };

      return (
        <div className="note-area">
          <select
            className="font-select"
            value={font}
            onChange={e => setFont(e.target.value)}>
            <option value="HJSS">HJSS</option>
            <option value="ywoo">ywoo</option>
            <option value="bbang">bbang</option>
            <option value="caa">caa</option>
          </select>
          <input
            type="color"
            className="color-picker"
            value={highlightColor}
            onChange={e => onColorChange(e.target.value)} />

          <div className="section">
            <h2 style={{ color: highlightColor }}>·¥ç·¥è Ä…¥…™…¥…¢</h2>
            {editingMorning
              ? <textarea
                  rows={4}
                  value={morning}
                  onChange={e => setMorning(e.target.value)}
                  onKeyDown={e =>
                    handleKeyDown(e, morning, setMorning,
                                  `pages/${dateKey}/morning`,
                                  setEditingMorning)
                  }
                  style={{ borderColor: highlightColor }}
                  placeholder="Î™®ÎãùÌéòÏù¥ÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
              : <div
                  className="saved-text"
                  style={{ fontFamily: font, cursor: 'pointer' }}
                  onDoubleClick={() => setEditingMorning(true)}>
                  {morning.split('\n').map((line, i) =>
                    <p key={i}>{line}</p>
                  )}
                </div>
            }
          </div>

          <MoodTracker dateKey={dateKey} highlightColor={highlightColor} />

          <div className="section">
            <h2 style={{ color: highlightColor }}>·¥á·¥†·¥á…¥…™…¥…¢</h2>
            {editingGratitude
              ? <textarea
                  rows={4}
                  value={gratitude}
                  onChange={e => setGratitude(e.target.value)}
                  onKeyDown={e =>
                    handleKeyDown(e, gratitude, setGratitude,
                                  `pages/${dateKey}/gratitude`,
                                  setEditingGratitude)
                  }
                  style={{ borderColor: highlightColor }}
                  placeholder="Í∞êÏÇ¨ÏùºÍ∏∞Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" />
              : <div
                  className="saved-text"
                  style={{ fontFamily: font, cursor: 'pointer' }}
                  onDoubleClick={() => setEditingGratitude(true)}>
                  {gratitude.split('\n').map((line, i) =>
                    <p key={i}>{line}</p>
                  )}
                </div>
            }
          </div>

          <button
            onClick={exportImage}
            style={{
              marginTop:'1rem', padding:'.5rem',
              background:highlightColor, color:'#fff',
              border:'none', borderRadius:'.25rem',
              cursor:'pointer'
            }}>
            Export Image
          </button>
        </div>
      );
    }

    function MonthlySummary({ year, month }) {
      /* Í∏∞Ï°¥ Íµ¨ÌòÑ Ïú†ÏßÄ */
      // ‚Ä¶
    }

    function App() {
      /* Í∏∞Ï°¥ App Íµ¨ÌòÑ Ïú†ÏßÄ */
      // ‚Ä¶
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
